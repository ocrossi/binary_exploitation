#include <stdio.h>
#include <string.h>
#include <stdint.h>

void clear_stdin(void) {
	int c;

	do {
		c = getchar();
	} while ((char)c != -1 && c != '\n');
}

int get_unum(void) {
	int a;
	int b;
	int c;

	a = 0;

	fflush(stdout);
	scanf("%u", &a);

	clear_stdin();

	return a;
}

int store_number(unsigned *data) {
	unsigned number;
	unsigned index;
	int storage_error;

	printf(" Number: ");
	number = get_unum();

	printf(" Index: ");
	index = get_unum();

	if ((index % 3 == 0) || (number >> 24 == 183)) {
		puts(" *** ERROR! ***");
		puts("   This index is reserved for wil!");
		puts(" *** ERROR! ***");

		storage_error = 1;
	} else {
		data[index] = number;

		storage_error = 0;
	}

	return storage_error;
}

int read_number(unsigned *data) {
	unsigned index;

	printf(" Index: ");
	index = get_unum();

	printf(" Number at data[%u] is %u\n", index, data[index]);

	return 0;
}

int main(int ac, char **av, char **ep) {
	unsigned len;
	unsigned data[100];
	int ret_read_num;
	char command[20];

	ret_read_num = 0;

	memset(command, 0, sizeof(command));

	memset(data, 0, sizeof(data));
	// clear each argument
	for (char **arg = av; *arg != NULL; ++arg) {
		memset(*arg, 0, strlen(*arg));
	}

	// clear each env variable
	for (char **entry = ep; *entry != NULL; ++entry) {
		memset(*entry, 0, strlen(*entry));
	}

	puts(
"----------------------------------------------------\n"
"  Welcome to wil\'s crappy number stora ge service!   \n"
"----------------------------------------------------\n"
" Commands:                                          \n"
"    store - store a number into the data storage    \n"
"    read  - read a number from the data storage     \n"
"    quit  - exit the program                        \n"
"----------------------------------------------------\n"
"   wil has reserved some storage :>                 \n"
"----------------------------------------------------\n"
);

	do {
		printf("Input command: ");
		ret_read_num = 1;

		fgets(command, 20, stdin);

		len = strlen(command);

		// Strip last character (\n) from end of line
		command[len - 1] = '\0';

		if (strncmp(command, "store", 5) == 0) {
			ret_read_num = store_number(data);
		} else {
			if (strncmp(command, "read", 4) == 0) {
				ret_read_num = read_number(data);
			} else {
				if (strncmp(command, "quit", 4) == 0) {
					return 0;
				}
			}
		}
		if (ret_read_num == 0) {
			printf(" Completed %s command successfully\n", command);
		} else {
			printf(" Failed to do %s command\n", command);
		}
		memset(command, 0, sizeof(command));
	} while (1);
}
